- When we need to conduct an internal penetration test for the entire network of a company, for example, then we should, first of all, get an overview of which systems are online that we can work with. To actively discover such systems on the network, we can use various `Nmap` host discovery options. There are many options `Nmap` provides to determine whether our target is alive or not. The most effective host discovery method is to use **ICMP echo requests**, which we will look into.
- ## Scan Network Range
	- ```bash
	  sudo nmap 10.129.2.0/24 -sn -oA tnet | grep for | cut -d" " -f5
	  ```
	  ```output
	  10.129.2.4
	  10.129.2.10
	  10.129.2.11
	  10.129.2.18
	  10.129.2.19
	  10.129.2.20
	  10.129.2.28
	  ```
	- ### Scanning Options:
		- 10.129.2.0/24 - Target Network Range
		- -sn - Disables port scanning
		- -oA tnet - Stores the results in all formats starting with the name tnet.
	- This scanning method works only if the firewalls of the hosts allow it. 
	  Otherwise, we can use other scanning techniques to find out if the hosts
	   are active or not.
- ## Scan IP List
	- We can also supply a list of hosts with the `-iL` flag:
	- ```bash
	  sudo nmap -sn -oA tnet -iL hosts.lst | grep for | cut -d" " -f5
	  ```
- ##
- ## Scan Multiple IPs
	- We can also supply multiple IPs on the CLI
	  ```bash
	  sudo nmap -sn -oA tnet 10.129.2.18 10.129.2.19 10.129.2.20| grep for | cut -d" " -f5
	  ```
	- Similarly, we may define a range if the IPs are sequential
	  ```bash
	  sudo nmap -sn -oA tnet 10.129.2.18-20| grep for | cut -d" " -f5
	  ```
- ## Scan Single IP
	- Before we scan a single host for open ports and its services, we first 
	  have to determine if it is alive or not. For this, we can use the same 
	  method as before.
	  ```bash
	  sudo nmap 10.129.2.18 -sn -oA host 
	  ```
	  ```output
	  Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-14 23:59 CEST
	  Nmap scan report for 10.129.2.18
	  Host is up (0.087s latency).
	  MAC Address: DE:AD:00:00:BE:EF
	  Nmap done: 1 IP address (1 host up) scanned in 0.11 seconds
	  ```
	- If we disable port scan (`-sn`), Nmap automatically ping scan with `ICMP Echo Requests` (`-PE`). Once such a request is sent, we usually expect an `ICMP reply` if the pinging host is alive. The more interesting fact is that our previous scans did not do that because before Nmap could send an ICMP echo request, it would send an `ARP ping` resulting in an `ARP reply`. We can confirm this with the "`--packet-trace`" option. To ensure that ICMP echo requests are sent, we also define the option (`-PE`) for this.
	  ```bash
	  sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace 
	  ```
	  ```output
	  Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 00:08 CEST
	  SENT (0.0074s) ARP who-has 10.129.2.18 tell 10.10.14.2
	  RCVD (0.0309s) ARP reply 10.129.2.18 is-at DE:AD:00:00:BE:EF
	  Nmap scan report for 10.129.2.18
	  Host is up (0.023s latency).
	  MAC Address: DE:AD:00:00:BE:EF
	  Nmap done: 1 IP address (1 host up) scanned in 0.05 seconds
	  ```
	- ### Scanning Options
		- -PE - Performs the ping scan by using "ICMP Echo requests" against the target
		- --packet-trace - Shows all packet sent and received
	- Another way to determine why Nmap has our target marked as "alive" is with the "`--reason`" option.
	- ```bash
	  sudo nmap 10.129.2.18 -sn -oA host -PE --reason 
	  ```
	  ```output
	  Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 00:10 CEST
	  SENT (0.0074s) ARP who-has 10.129.2.18 tell 10.10.14.2
	  RCVD (0.0309s) ARP reply 10.129.2.18 is-at DE:AD:00:00:BE:EF
	  Nmap scan report for 10.129.2.18
	  Host is up, received arp-response (0.028s latency).
	  MAC Address: DE:AD:00:00:BE:EF
	  Nmap done: 1 IP address (1 host up) scanned in 0.03 seconds
	  ```
	- ### Scanning Options
		- --reason - Displays the reason for specific result.
	- We see here that `Nmap` does indeed detect whether the host is alive or not through the `ARP request` and `ARP reply` alone. To disable ARP requests and scan our target with the desired `ICMP echo requests`, we can disable ARP pings by setting the "`--disable-arp-ping`" option. Then we can scan our target again and look at the packets sent and received.
	  ```bash
	  sudo nmap 10.129.2.18 -sn -oA host -PE --packet-trace --disable-arp-ping 
	  ```
	  ```output
	  Starting Nmap 7.80 ( https://nmap.org ) at 2020-06-15 00:12 CEST
	  SENT (0.0107s) ICMP [10.10.14.2 > 10.129.2.18 Echo request (type=8/code=0) id=13607 seq=0] IP [ttl=255 id=23541 iplen=28 ]
	  RCVD (0.0152s) ICMP [10.129.2.18 > 10.10.14.2 Echo reply (type=0/code=0) id=13607 seq=0] IP [ttl=128 id=40622 iplen=28 ]
	  Nmap scan report for 10.129.2.18
	  Host is up (0.086s latency).
	  MAC Address: DE:AD:00:00:BE:EF
	  Nmap done: 1 IP address (1 host up) scanned in 0.11 seconds
	  ```
- **Note** TTL of 128 for ICMP suggests windows. A list can be found [here](https://ostechnix.com/identify-operating-system-ttl-ping/)